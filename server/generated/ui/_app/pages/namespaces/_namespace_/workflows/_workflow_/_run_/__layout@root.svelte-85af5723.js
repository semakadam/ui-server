var Ne=Object.defineProperty;var $e=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable;var Te=(r,e,a)=>e in r?Ne(r,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[e]=a,me=(r,e)=>{for(var a in e||(e={}))Re.call(e,a)&&Te(r,a,e[a]);if($e)for(var a of $e(e))Ve.call(e,a)&&Te(r,a,e[a]);return r};import{S as x,i as ee,s as te,w as T,k as I,x as E,m as A,y as Q,g as W,q as p,o as g,B as S,d as u,l as Ie,n as je,p as De,t as F,h as N,e as _,c as k,a as b,b as w,M as c,E as se,Y as Ee,T as Oe,R as Ae,N as Ce,C as Qe,U as Se,j as ne,I as He,J as Me,K as qe,L as Be}from"../../../../../../chunks/index-1b46dd35.js";import{e as We,f as Le,g as Ue,h as Je,i as Ke,j as Ye}from"../../../../../../chunks/route-for-789b7fae.js";import{r as we,a as he,h as ze}from"../../../../../../chunks/route-for-api-e9ca21c2.js";import{W as Ge,f as Xe}from"../../../../../../chunks/workflow-status-eb4a900b.js";import{I as Ze}from"../../../../../../chunks/index-3685084d.js";import{e as xe}from"../../../../../../chunks/event-view-075dee1d.js";import{n as et}from"../../../../../../chunks/notifications-b5b1bba1.js";import{B as Fe}from"../../../../../../chunks/button-5dc003c0.js";import{M as tt}from"../../../../../../chunks/modal-b584d354.js";import{f as at}from"../../../../../../chunks/events-service-f3cfcdba.js";import{i as st}from"../../../../../../chunks/index.es-3c939ced.js";import{p as nt}from"../../../../../../chunks/stores-8b8b27f9.js";import"../../../../../../chunks/index-92abd382.js";import"../../../../../../chunks/is-network-error-ac7c8caf.js";import"../../../../../../chunks/simplify-attributes-f7b4503d.js";import"../../../../../../chunks/format-date-188b28af.js";import"../../../../../../chunks/persist-store-4ece08a3.js";import"../../../../../../chunks/index-3c12228a.js";import"../../../../../../chunks/is-http-1ac902cc.js";import"../../../../../../chunks/data-converter-config-b8039691.js";import"../../../../../../chunks/atob-eb4fc9a1.js";import"../../../../../../chunks/index-8821dfb5.js";import"../../../../../../chunks/get-event-categorization-20095c1b.js";async function rt(r,e=fetch){const a=await we(he("task-queue",r),{request:e,params:{taskQueueType:"1"}}),n=await we(he("task-queue",r),{request:e,params:{taskQueueType:"2"}});n.pollers.forEach(t=>{t.taskQueueTypes=["ACTIVITY"]}),a.pollers.forEach(t=>{t.taskQueueTypes=["WORKFLOW"]});const s=t=>(o,f)=>{const l=o[f.identity]||{lastAccessTime:void 0,taskQueueTypes:[]};return o[f.identity]={lastAccessTime:!l.lastAccessTime||l.lastAccessTime<f.lastAccessTime?f.lastAccessTime:l.lastAccessTime,taskQueueTypes:l.taskQueueTypes.concat([t])},o};return n.pollers.filter(t=>a.pollers.some(o=>{if(t.identity===o.identity)return t.taskQueueTypes=[...o.taskQueueTypes,...t.taskQueueTypes],t})),n.pollers.reduce(s("ACTIVITY"),a.pollers.reduce(s("WORKFLOW"),{})),{pollers:n.pollers,taskQueueStatus:n.taskQueueStatus}}async function ot({workflow:r,namespace:e,reason:a}){return await we(he("workflow.terminate",{namespace:e,workflowId:r.id,runId:r.runId}),{options:{method:"POST",body:JSON.stringify({reason:a})},shouldRetry:!1})}function Pe(r){let e,a,n,s;return e=new Fe({props:{destroy:!0,$$slots:{default:[lt]},$$scope:{ctx:r}}}),e.$on("click",r[3]),n=new tt({props:{open:r[2],confirmText:"Terminate",$$slots:{content:[it],title:[ft]},$$scope:{ctx:r}}}),n.$on("cancelModal",r[4]),n.$on("confirmModal",r[6]),{c(){T(e.$$.fragment),a=I(),T(n.$$.fragment)},l(t){E(e.$$.fragment,t),a=A(t),E(n.$$.fragment,t)},m(t,o){Q(e,t,o),W(t,a,o),Q(n,t,o),s=!0},p(t,o){const f={};o&1024&&(f.$$scope={dirty:o,ctx:t}),e.$set(f);const l={};o&4&&(l.open=t[2]),o&1026&&(l.$$scope={dirty:o,ctx:t}),n.$set(l)},i(t){s||(p(e.$$.fragment,t),p(n.$$.fragment,t),s=!0)},o(t){g(e.$$.fragment,t),g(n.$$.fragment,t),s=!1},d(t){S(e,t),t&&u(a),S(n,t)}}}function lt(r){let e;return{c(){e=F("Terminate")},l(a){e=N(a,"Terminate")},m(a,n){W(a,e,n)},d(a){a&&u(e)}}}function ft(r){let e,a;return{c(){e=_("h3"),a=F("Terminate Workflow"),this.h()},l(n){e=k(n,"H3",{slot:!0});var s=b(e);a=N(s,"Terminate Workflow"),s.forEach(u),this.h()},h(){w(e,"slot","title")},m(n,s){W(n,e,s),c(e,a)},p:se,d(n){n&&u(e)}}}function it(r){let e,a,n,s,t,o,f;return{c(){e=_("div"),a=_("p"),n=F(`Are you sure you want to terminate this workflow? This action cannot be
        undone.`),s=I(),t=_("input"),this.h()},l(l){e=k(l,"DIV",{slot:!0});var m=b(e);a=k(m,"P",{});var v=b(a);n=N(v,`Are you sure you want to terminate this workflow? This action cannot be
        undone.`),v.forEach(u),s=A(m),t=k(m,"INPUT",{class:!0,placeholder:!0}),m.forEach(u),this.h()},h(){w(t,"class","mt-4 block w-full rounded-md border border-gray-200 p-2"),w(t,"placeholder","Enter a reason"),w(e,"slot","content")},m(l,m){W(l,e,m),c(e,a),c(a,n),c(e,s),c(e,t),Ee(t,r[1]),o||(f=Oe(t,"input",r[8]),o=!0)},p(l,m){m&2&&t.value!==l[1]&&Ee(t,l[1])},d(l){l&&u(e),o=!1,f()}}}function ut(r){let e=r[5](r[0]),a,n,s=e&&Pe(r);return{c(){s&&s.c(),a=Ie()},l(t){s&&s.l(t),a=Ie()},m(t,o){s&&s.m(t,o),W(t,a,o),n=!0},p(t,[o]){o&1&&(e=t[5](t[0])),e?s?(s.p(t,o),o&1&&p(s,1)):(s=Pe(t),s.c(),p(s,1),s.m(a.parentNode,a)):s&&(je(),g(s,1,1,()=>{s=null}),De())},i(t){n||(p(s),n=!0)},o(t){g(s),n=!1},d(t){s&&s.d(t),t&&u(a)}}}function ct(r,e,a){let{workflow:n}=e,{namespace:s}=e,t="",o=!1;const f=()=>a(2,o=!0),l=()=>a(2,o=!1),m=h=>String(h.status)==="Running",v=()=>{a(2,o=!1),a(1,t=""),et.add("success","Workflow Terminated"),window.location.reload()},P=()=>{ot({workflow:n,namespace:s,reason:t}).then(v).catch(ze)};function q(){t=this.value,a(1,t)}return r.$$set=h=>{"workflow"in h&&a(0,n=h.workflow),"namespace"in h&&a(7,s=h.namespace)},[n,t,o,f,l,m,P,s,q]}class mt extends x{constructor(e){super(),ee(this,e,ct,ut,te,{workflow:0,namespace:7})}}function wt(r){let e,a;return{c(){e=_("span"),a=F("Download"),this.h()},l(n){e=k(n,"SPAN",{class:!0});var s=b(e);a=N(s,"Download"),s.forEach(u),this.h()},h(){w(e,"class","hidden md:inline")},m(n,s){W(n,e,s),c(e,a)},p:se,d(n){n&&u(e)}}}function ht(r){let e,a;return e=new Fe({props:{secondary:!0,icon:st,$$slots:{default:[wt]},$$scope:{ctx:r}}}),e.$on("click",r[0]),{c(){T(e.$$.fragment)},l(n){E(e.$$.fragment,n)},m(n,s){Q(e,n,s),a=!0},p(n,[s]){const t={};s&16&&(t.$$scope={dirty:s,ctx:n}),e.$set(t)},i(n){a||(p(e.$$.fragment,n),a=!0)},o(n){g(e.$$.fragment,n),a=!1},d(n){S(e,n)}}}function dt(r,e,a){let{namespace:n}=e,{workflowId:s}=e,{runId:t}=e;const o=async()=>{const f=await at({namespace:n,workflowId:s,runId:t}),l=JSON.stringify({events:f},null,2);m(l,`${t}/events.json`,"text/plain");function m(v,P,q){const h=document.createElement("a"),B=new Blob([v],{type:q});h.href=URL.createObjectURL(B),h.download=P,h.click()}};return r.$$set=f=>{"namespace"in f&&a(1,n=f.namespace),"workflowId"in f&&a(2,s=f.workflowId),"runId"in f&&a(3,t=f.runId)},[o,n,s,t]}class pt extends x{constructor(e){super(),ee(this,e,dt,ht,te,{namespace:1,workflowId:2,runId:3})}}function _t(r){let e;return{c(){e=F(r[1])},l(a){e=N(a,r[1])},m(a,n){W(a,e,n)},p(a,n){n&2&&ne(e,a[1])},d(a){a&&u(e)}}}function kt(r){let e,a,n,s;return{c(){e=F(r[1]),a=I(),n=_("span"),s=F(r[2]),this.h()},l(t){e=N(t,r[1]),a=A(t),n=k(t,"SPAN",{class:!0});var o=b(n);s=N(o,r[2]),o.forEach(u),this.h()},h(){w(n,"class","rounded-sm bg-blue-100 px-2 text-blue-700")},m(t,o){W(t,e,o),W(t,a,o),W(t,n,o),c(n,s)},p(t,o){o&2&&ne(e,t[1]),o&4&&ne(s,t[2])},d(t){t&&u(e),t&&u(a),t&&u(n)}}}function gt(r){let e,a;function n(o,f){return o[2]||o[2]===0?kt:_t}let s=n(r),t=s(r);return{c(){e=_("a"),t.c(),this.h()},l(o){e=k(o,"A",{class:!0,href:!0,"data-cy":!0});var f=b(e);t.l(f),f.forEach(u),this.h()},h(){w(e,"class","block whitespace-nowrap text-sm md:text-base svelte-sf1jtj"),w(e,"href",r[0]),w(e,"data-cy",a=r[4].dataCy),Ae(e,"active",r[3])},m(o,f){W(o,e,f),t.m(e,null)},p(o,[f]){s===(s=n(o))&&t?t.p(o,f):(t.d(1),t=s(o),t&&(t.c(),t.m(e,null))),f&1&&w(e,"href",o[0]),f&16&&a!==(a=o[4].dataCy)&&w(e,"data-cy",a),f&8&&Ae(e,"active",o[3])},i:se,o:se,d(o){o&&u(e),t.d()}}}function bt(r,e,a){let n,s;Ce(r,nt,l=>a(5,s=l));let{href:t}=e,{label:o}=e,{amount:f=null}=e;return r.$$set=l=>{a(4,e=Qe(Qe({},e),Se(l))),"href"in l&&a(0,t=l.href),"label"in l&&a(1,o=l.label),"amount"in l&&a(2,f=l.amount)},r.$$.update=()=>{r.$$.dirty&33&&a(3,n=s.url.pathname.includes(t))},e=Se(e),[t,o,f,n,e,s]}class Z extends x{constructor(e){super(),ee(this,e,bt,gt,te,{href:0,label:1,amount:2})}}function vt(r){var de,pe,_e,ke,ge;let e,a,n,s,t,o,f,l,m,v,P,q,h,B=r[1].id+"",ae,re,R,V,oe,j,le,y,D,fe,O,ie,H,ue,L,ce,U,G;return t=new Ze({props:{name:"caretLeft",class:"inline"}}),P=new Ge({props:{status:(de=r[1])==null?void 0:de.status}}),V=new pt({props:{namespace:r[0],workflowId:r[1].id,runId:r[1].runId}}),j=new mt({props:{workflow:r[1],namespace:r[0]}}),D=new Z({props:{label:"History",href:We(me({view:r[3]},r[4])),amount:(pe=r[1])==null?void 0:pe.historyEvents,dataCy:"history-tab"}}),O=new Z({props:{label:"Workers",href:Le(r[4]),amount:(ke=(_e=r[2])==null?void 0:_e.pollers)==null?void 0:ke.length,dataCy:"workers-tab"}}),H=new Z({props:{label:"Pending Activities",href:Ue(r[4]),amount:(ge=r[1].pendingActivities)==null?void 0:ge.length,dataCy:"pending-activities-tab"}}),L=new Z({props:{label:"Stack Trace",href:Je(r[4]),dataCy:"stack-trace-tab"}}),U=new Z({props:{label:"Queries",href:Ke(r[4]),dataCy:"queries-tab"}}),{c(){e=_("header"),a=_("main"),n=_("div"),s=_("a"),T(t.$$.fragment),o=F("Back to Workflows"),l=I(),m=_("div"),v=_("h1"),T(P.$$.fragment),q=I(),h=_("span"),ae=F(B),re=I(),R=_("div"),T(V.$$.fragment),oe=I(),T(j.$$.fragment),le=I(),y=_("nav"),T(D.$$.fragment),fe=I(),T(O.$$.fragment),ie=I(),T(H.$$.fragment),ue=I(),T(L.$$.fragment),ce=I(),T(U.$$.fragment),this.h()},l(i){e=k(i,"HEADER",{class:!0});var d=b(e);a=k(d,"MAIN",{class:!0});var C=b(a);n=k(C,"DIV",{class:!0});var J=b(n);s=k(J,"A",{href:!0,class:!0});var K=b(s);E(t.$$.fragment,K),o=N(K,"Back to Workflows"),K.forEach(u),J.forEach(u),l=A(C),m=k(C,"DIV",{class:!0});var M=b(m);v=k(M,"H1",{class:!0});var Y=b(v);E(P.$$.fragment,Y),q=A(Y),h=k(Y,"SPAN",{class:!0});var X=b(h);ae=N(X,B),X.forEach(u),Y.forEach(u),re=A(M),R=k(M,"DIV",{class:!0});var z=b(R);E(V.$$.fragment,z),oe=A(z),E(j.$$.fragment,z),z.forEach(u),M.forEach(u),le=A(C),y=k(C,"NAV",{class:!0});var $=b(y);E(D.$$.fragment,$),fe=A($),E(O.$$.fragment,$),ie=A($),E(H.$$.fragment,$),ue=A($),E(L.$$.fragment,$),ce=A($),E(U.$$.fragment,$),$.forEach(u),C.forEach(u),d.forEach(u),this.h()},h(){w(s,"href",f="/namespaces/"+r[0]+"/workflows"),w(s,"class","back-to-workflows svelte-st9g8m"),w(n,"class","-mt-3 -ml-2 block"),w(h,"class","select-all font-medium"),w(v,"class","relative flex items-center gap-4 text-2xl"),w(R,"class","ml-8 flex items-center justify-end gap-4"),w(m,"class","mb-8 flex items-center justify-between"),w(y,"class","flex flex-wrap gap-6"),w(a,"class","relative flex flex-col gap-1"),w(e,"class","flex flex-col gap-4")},m(i,d){W(i,e,d),c(e,a),c(a,n),c(n,s),Q(t,s,null),c(s,o),c(a,l),c(a,m),c(m,v),Q(P,v,null),c(v,q),c(v,h),c(h,ae),c(m,re),c(m,R),Q(V,R,null),c(R,oe),Q(j,R,null),c(a,le),c(a,y),Q(D,y,null),c(y,fe),Q(O,y,null),c(y,ie),Q(H,y,null),c(y,ue),Q(L,y,null),c(y,ce),Q(U,y,null),G=!0},p(i,[d]){var z,$,be,ve,ye;(!G||d&1&&f!==(f="/namespaces/"+i[0]+"/workflows"))&&w(s,"href",f);const C={};d&2&&(C.status=(z=i[1])==null?void 0:z.status),P.$set(C),(!G||d&2)&&B!==(B=i[1].id+"")&&ne(ae,B);const J={};d&1&&(J.namespace=i[0]),d&2&&(J.workflowId=i[1].id),d&2&&(J.runId=i[1].runId),V.$set(J);const K={};d&2&&(K.workflow=i[1]),d&1&&(K.namespace=i[0]),j.$set(K);const M={};d&8&&(M.href=We(me({view:i[3]},i[4]))),d&2&&(M.amount=($=i[1])==null?void 0:$.historyEvents),D.$set(M);const Y={};d&4&&(Y.amount=(ve=(be=i[2])==null?void 0:be.pollers)==null?void 0:ve.length),O.$set(Y);const X={};d&2&&(X.amount=(ye=i[1].pendingActivities)==null?void 0:ye.length),H.$set(X)},i(i){G||(p(t.$$.fragment,i),p(P.$$.fragment,i),p(V.$$.fragment,i),p(j.$$.fragment,i),p(D.$$.fragment,i),p(O.$$.fragment,i),p(H.$$.fragment,i),p(L.$$.fragment,i),p(U.$$.fragment,i),G=!0)},o(i){g(t.$$.fragment,i),g(P.$$.fragment,i),g(V.$$.fragment,i),g(j.$$.fragment,i),g(D.$$.fragment,i),g(O.$$.fragment,i),g(H.$$.fragment,i),g(L.$$.fragment,i),g(U.$$.fragment,i),G=!1},d(i){i&&u(e),S(t),S(P),S(V),S(j),S(D),S(O),S(H),S(L),S(U)}}}function yt(r,e,a){let n;Ce(r,xe,l=>a(3,n=l));let{namespace:s}=e,{workflow:t}=e,{workers:o}=e;const f={namespace:s,workflow:t.id,run:t.runId};return r.$$set=l=>{"namespace"in l&&a(0,s=l.namespace),"workflow"in l&&a(1,t=l.workflow),"workers"in l&&a(2,o=l.workers)},[s,t,o,n,f]}class $t extends x{constructor(e){super(),ee(this,e,yt,vt,te,{namespace:0,workflow:1,workers:2})}}function Tt(r){let e,a,n,s;a=new $t({props:{namespace:r[1],workflow:r[0],workers:r[2]}});const t=r[4].default,o=He(t,r,r[3],null);return{c(){e=_("main"),T(a.$$.fragment),n=I(),o&&o.c(),this.h()},l(f){e=k(f,"MAIN",{class:!0});var l=b(e);E(a.$$.fragment,l),n=A(l),o&&o.l(l),l.forEach(u),this.h()},h(){w(e,"class","flex h-full flex-col gap-6")},m(f,l){W(f,e,l),Q(a,e,null),c(e,n),o&&o.m(e,null),s=!0},p(f,[l]){const m={};l&2&&(m.namespace=f[1]),l&1&&(m.workflow=f[0]),l&4&&(m.workers=f[2]),a.$set(m),o&&o.p&&(!s||l&8)&&Me(o,t,f,f[3],s?Be(t,f[3],l,null):qe(f[3]),null)},i(f){s||(p(a.$$.fragment,f),p(o,f),s=!0)},o(f){g(a.$$.fragment,f),g(o,f),s=!1},d(f){f&&u(e),S(a),o&&o.d(f)}}}const Gt=async function({params:r,fetch:e}){const{workflow:a,run:n,namespace:s}=r,t={namespace:s,workflowId:Ye(a),runId:n},o=await Xe(t,e),{taskQueue:f}=o,l=await rt({queue:f,namespace:s});return{props:{workflow:o,namespace:s,workers:l},stuff:{workflow:o,workers:l}}};function It(r,e,a){let{$$slots:n={},$$scope:s}=e,{workflow:t}=e,{namespace:o}=e,{workers:f}=e;return r.$$set=l=>{"workflow"in l&&a(0,t=l.workflow),"namespace"in l&&a(1,o=l.namespace),"workers"in l&&a(2,f=l.workers),"$$scope"in l&&a(3,s=l.$$scope)},[t,o,f,s,n]}class Xt extends x{constructor(e){super(),ee(this,e,It,Tt,te,{workflow:0,namespace:1,workers:2})}}export{Xt as default,Gt as load};
